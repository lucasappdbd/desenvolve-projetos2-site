{% extends "base.html" %}

{% block header %}
    <h1>Meu Perfil</h1>
{% endblock %}

{% block main %}
    <div class="perfil-info">
        <h2>{{ current_user.nome }} {{ current_user.sobrenome }}</h2>
        <p>{{ current_user.email }}</p>
        <button id="btn-editar-perfil">Editar Perfil</button>


        <section class="avaliacoes-usuario">
        <h2>Minhas Avaliações</h2>

        {% if avaliacoes %}
            <ul>
                {% for avaliacao in avaliacoes %}
                    <li>
                        <strong>Você</strong> avaliou em {{ (avaliacao.created_at - timedelta(hours=3)).strftime('%d/%m/%Y') }} às {{ (avaliacao.created_at - timedelta(hours=3)).strftime('%H:%M') }}:<br>

                        {% for i in range(1, 6) %}
                            {% if i <= avaliacao.rating %}
                                <span style="color: gold;">&#9733;</span>
                            {% else %}
                                <span style="color: #ccc;">&#9733;</span>
                            {% endif %}
                        {% endfor %}

                        - <em>{{ avaliacao.book.title }}</em><br>
                        "{{ avaliacao.comment }}"
                        </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Você ainda não fez nenhuma avaliação.</p>
        {% endif %}
        </section>

    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/perfil.js') }}"></script>
{% endblock %}

{% block modals %}
    <div id="modal-perfil" class="modal hidden">
        <div class="modal-perfil-content">
            <button class="modal-perfil-close" id="btn-fechar-modal">&times;</button>
            <h2>Editar Perfil</h2>
            <form method="POST" action="{{ url_for('views.perfil') }}" class="form-cadastro">

            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" required value="{{ current_user.nome }}">

            <label for="sobrenome">Sobrenome:</label>
            <input type="text" id="sobrenome" name="sobrenome" required value="{{ current_user.sobrenome }}">

            <label for="email">E-mail:</label>
            <input type="email" id="email" name="email" required value="{{ current_user.email }}">

            <label for="senha">Senha (deixe em branco para manter a atual):</label>
            <input type="password" id="senha" name="senha" placeholder="Digite nova senha se quiser mudar">

            <div style="display: flex; justify-content: space-evenly; gap: 10px;">
                <button type="submit">Salvar Alterações</button>
                <button type="button" class="btn-cancelar" id="cancelar-edicao">Cancelar</button>          
            </div>
            </form>
        </div>
    </div>
{% endblock %}